slam_toolbox:
  ros__parameters:
    # ===== 核心求解器优化 (降低计算负载) =====
    solver_plugin: solver_plugins::CeresSolver
    ceres_linear_solver: SPARSE_QR  # 更节省内存，适合嵌入式平台
    ceres_preconditioner: SCHUR_JACOBI
    ceres_trust_strategy: LEVENBERG_MARQUARDT
    ceres_dogleg_type: TRADITIONAL_DOGLEG
    ceres_loss_function: None
    ceres_max_iterations: 5  # 限制迭代次数减轻CPU负担

    # ===== 坐标系设置 =====
    odom_frame: odom
    map_frame: map
    base_frame: base_link
    scan_frame: livox_frame
    imu_frame: lidar_frame
    
    # ===== 运行模式 =====
    mode: online_async  # 保持异步模式
    debug_logging: false  # 关闭调试日志减少IO
    
    # ===== 传感器参数优化 =====
    throttle_scans: 1       # 保持逐帧处理
    min_laser_range: 0.3
    max_laser_range: 20.0   # 降低至20m减少无效计算
    
    # ===== 时间参数优化 =====
    transform_publish_period: 0.02  # 提高TF发布频率
    map_update_interval: 2.0        # 延长地图更新间隔
    minimum_time_interval: 0.15     # 增加最小时间间隔
    transform_timeout: 0.15
    tf_buffer_duration: 5.0         # 缩短缓冲时间
    
    # ===== 性能关键参数 =====
    stack_size_to_use: 20000000     # 栈内存减半 (40M->20M)
    enable_interactive_mode: false  # 关闭交互模式节省资源
    resolution: 0.15               # 降低地图分辨率
    
    # ===== Mid-360 特殊优化 =====
    scan_buffer_size: 20            # 增大缓存帧数
    scan_buffer_maximum_scan_distance: 6.0  # 缩小最大匹配距离
    
    # ===== IMU融合优化 =====
    use_imu: true
    imu_upsampling: 1              # 禁用上采样 (原始频率)
    imu_gravity_constant: 9.806
    imu_linear_correction: true
    imu_angular_correction: true
    
    # ===== 小FOV扫描匹配优化 =====
    correlation_search_space_dimension: 0.8  # 缩小搜索空间
    loop_search_space_dimension: 8.0         # 降低回环搜索强度
    loop_search_maximum_distance: 4.0        # 缩短回环搜索距离
    
    # ===== 运动阈值调整 =====
    use_scan_matching: true
    use_scan_barycenter: true
    minimum_travel_distance: 0.4    # 增大运动阈值
    minimum_travel_heading: 0.4     # 增大旋转阈值
    
    # ===== 回环检测优化 (降低CPU峰值) =====
    do_loop_closing: true
    loop_match_minimum_chain_size: 6          # 减少闭环链长
    loop_match_minimum_response_coarse: 0.35  # 提高匹配阈值
    loop_match_minimum_response_fine: 0.45
    
    # ===== 协方差调整 =====
    distance_variance_penalty: 0.4
    angle_variance_penalty: 1.0
    
    # ===== 噪声模型 =====
    imu_linear_acceleration_noise: 0.1   # 放宽IMU噪声约束
    imu_angular_velocity_noise: 0.05
